!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=36)}({1:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(7);var o=n(3),a=n(8);function i(t,e){return Object(r.a)(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}}(t,e)||Object(o.a)(t,e)||Object(a.a)()}},11:function(t,e,n){"use strict";function r(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}n.d(e,"a",(function(){return i}));var o=n(1),a=n(4);function i(){return{addStashEntries:function(t){var e=(new Date).toISOString();chrome.storage.sync.set(Object(a.a)({},e,t),(function(){chrome.storage.sync.get(null,(function(t){console.debug(t)}))}))},getStashEntries:function(t){chrome.storage.sync.get(null,(function(e){console.debug(e),t(Object.entries(e).sort((function(t,e){var n=Object(o.a)(t,1)[0],r=Object(o.a)(e,1)[0];return-n.localeCompare(r)})).map((function(t){var e=Object(o.a)(t,2),n=e[0],r=e[1],a=new Date(n);return{stashKey:n,date:{fullYear:a.getFullYear(),month:a.getMonth(),date:a.getDate(),day:a.getDay(),hours:a.getHours(),minutes:a.getMinutes()},entries:r}})).reduce((function(t,e){var n=e.stashKey,o=e.date,a=o.fullYear,i=o.month,c=o.date,u=o.day,s=r(o,["fullYear","month","date","day"]),f=e.entries,l=t[t.length-1];return l&&l.date.fullYear===a&&l.date.month===i&&l.date.date===c?l.entries.push({stashKey:n,time:s,entries:f}):t.push({date:{fullYear:a,month:i,date:c,day:u},entries:[{stashKey:n,time:s,entries:f}]}),t}),[]))}))},subscribeToStashEntryChanges:function(t){chrome.storage.onChanged.addListener((function(e,n){var r=[];for(var o in e){var a=e[o],i=new Date(o);console.debug("[STORAGE CHANGES] '%s' in '%s': old '%s' new '%s'",o,n,a.oldValue,a.newValue),void 0===a.oldValue?r.push({type:"add",date:{fullYear:i.getFullYear(),month:i.getMonth(),date:i.getDate(),day:i.getDay()},entry:{stashKey:o,time:{hours:i.getHours(),minutes:i.getMinutes()},entries:a.newValue}}):void 0===a.newValue?r.push({type:"remove",date:i,stashKey:o}):console.error("Unknown behaviour: update operation should not be supported")}t(r)}))}}}},2:function(t,e,n){"use strict";n.d(e,"j",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"f",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"i",(function(){return s})),n.d(e,"a",(function(){return f})),n.d(e,"e",(function(){return l})),n.d(e,"d",(function(){return d}));var r="WiNager default",o="detach",a="move",i="duplicate",c="navigate unpinned",u="stash",s="stash pop",f="toggle adjacent tab selection",l="tab activity history: go forward",d="tab activity history: go back"},3:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(5);function o(t,e){if(t){if("string"===typeof t)return Object(r.a)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(t,e):void 0}}},36:function(t,e,n){"use strict";n.r(e);var r=n(5);function o(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}var a=n(3);function i(t){return function(t){if(Array.isArray(t))return Object(r.a)(t)}(t)||o(t)||Object(a.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=n(7),u=n(8);function s(t){return Object(c.a)(t)||o(t)||Object(a.a)(t)||Object(u.a)()}var f=n(1),l=n(6),d=n(4),h=n(2);function b(t){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var n=Object(f.a)(e,1)[0];return t&&t(n)}))}function m(t,e,n){t.length>0&&function t(e,n,r,o){if(0===e.length)o&&o(r);else{var a=s(e),c=a[0],u=a.slice(1),f=s(n),l=f[0],d=f.slice(1);chrome.tabs.update(c,l,(function(e){t(u,d,[].concat(i(r),[e]),o)}))}}(t,e,[],n)}function v(){b((function(t){chrome.tabs.query({highlighted:!0,currentWindow:!0},(function(e){var n=e.map((function(t){return t.id}));!function(t,e,n){chrome.windows.create(null,(function(n){var r=n.id,o=new Array(e.length).fill({highlighted:!0});chrome.tabs.move(e,{windowId:r,index:-1},(function(){m(e.reverse(),o,(function(){!function(t,e){y(t,(function(t){return y(t,e)}))}(t),function(t,e){chrome.tabs.query({windowId:e,index:t},(function(t){var e=Object(f.a)(t,1)[0].id;chrome.tabs.remove(e)}))}(0,r)}))}))}))}(t,n)}))}))}function y(t,e){chrome.tabs.update(t.id,{highlighted:!t.highlighted},(function(t){return e&&e(t)}))}function g(t){chrome.tabs.query({currentWindow:!0},(function(e){var n=e.length,r=e.filter((function(t){return t.pinned})).length,o=n-r,a=e.filter((function(t){return t.highlighted})),i=function(e,n){if(n)return(e+t)%r;var a=(e-r+t)%o;return a<0?-1:r+a},c=a.map((function(t){var e=t.id,n=t.index,r=t.pinned;return[e,i(n,r)]}));!function t(e){if(0==e.length)return;var n=s(e),r=Object(f.a)(n[0],2),o=r[0],a=r[1],i=n.slice(1);chrome.tabs.move(o,{index:a},(function(){t(i)}))}(t>0?c.reverse():c)}))}function p(){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var e=Object(f.a)(t,1)[0];chrome.tabs.duplicate(e.id)}))}var w=n(11),O={name:"WiNager",actions:{"list stash entries":{displayName:"List Stash Entries",f:function(){console.debug("requestOpenStashModal"),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var e=Object(f.a)(t,1)[0];chrome.tabs.sendMessage(e.id,{type:"list stash entries"})}))}},detach:{displayName:"Detach Tabs",f:v},duplicate:{displayName:"Duplicate Tab",f:p},stash:{displayName:"Stash Tabs",f:S},pin:{displayName:"Toggle Pins",f:function(){chrome.tabs.query({highlighted:!0,currentWindow:!0},(function(t){var e,n=[],r=[],o=Object(l.a)(t);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.id,c=a.pinned;n.push(i),r.push({pinned:!c})}}catch(u){o.e(u)}finally{o.f()}m(n,r)}))}},reload:{displayName:"Reload All Tabs",f:function(){chrome.tabs.query({currentWindow:!0},(function(t){var e,n;(e=t.map((function(t){return t.id}))).length>0&&function t(e,n){if(0===e.length)n&&n();else{var r=s(e),o=r[0],a=r.slice(1);chrome.tabs.reload(o,(function(){t(a,n)}))}}(e,n)}))}},"select all":{displayName:"Select All Tabs",f:function(){function t(t,e){chrome.tabs.update(t.id,{highlighted:!t.highlighted},(function(t){return e&&e(t)}))}b((function(e){chrome.tabs.query({highlighted:!1,currentWindow:!0},(function(n){0!==n.length&&m(n.map((function(t){return t.id})),new Array(n.length).fill({highlighted:!0}),(function(){t(e,(function(e){return t(e)}))}))}))}))}},"clear selection":{displayName:"Clear Tab Selection",f:function(){chrome.tabs.query({highlighted:!0,active:!1,currentWindow:!0},(function(t){m(t.map((function(t){return t.id})),new Array(t.length).fill({highlighted:!1}))}))}},"reopen in incognito mode":{displayName:"Reopen in Incognito Mode",f:function(){chrome.tabs.query({highlighted:!0,currentWindow:!0},(function(t){var e,n=[],r=[],o=Object(l.a)(t);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.id,c=a.url;n.push(c),r.push(i),chrome.history.deleteUrl({url:c})}}catch(u){o.e(u)}finally{o.f()}chrome.windows.create({incognito:!0,url:n}),chrome.tabs.remove(r)}))}},"go to":{displayName:"Go to ...",f:function(t){e=function(e){console.debug(e);var n=e.map((function(t){var e=t.title+" "+I(t.url);return{value:t.id,iconUrl:t.favIconUrl,displayName:e}}));M(t,n)},W((function(t){var n=Object.entries(t).sort((function(t,e){var n=Object(f.a)(t,2),r=(n[0],n[1]),o=Object(f.a)(e,2);return o[0],o[1]-r}));!function(t,e){!function t(e,n,r){if(0!==e.length){var o=s(e),a=o[0],c=o.slice(1);chrome.tabs.get(a,(function(e){return t(c,[].concat(i(n),[e]),r)}))}else r(n)}(t,[],e)}(n.map((function(t){var e=Object(f.a)(t,2),n=e[0];return e[1],parseInt(n)})),(function(t){var r=t.map((function(t,e){var r=Object(f.a)(n[e],2);return{id:r[0],timestamp:r[1],title:t.title,favIconUrl:t.favIconUrl,url:t.url}}));e(r)}))}));var e}},"go to within":{displayName:"Go to Tab within Window",f:function(t){chrome.tabs.query({currentWindow:!0},(function(e){var n=e.map((function(t){var e=t.title+" "+I(t.url);return{value:t.id,iconUrl:t.favIconUrl,displayName:e}}));M(t,n)}))}},"go to window":{displayName:"Go to Window",f:function(t){W((function(e){chrome.tabs.query({active:!0},(function(n){var r=n.sort((function(t,n){var r=e[t.id],o=e[n.id];switch(!0){case void 0===r&&void 0===o:return 0;case void 0!==r&&void 0===o:return-1;case void 0===r&&void 0!==o:return 1;default:return o-r}})).map((function(t){var e=t.title+" "+I(t.url);return{value:t.id,iconUrl:t.favIconUrl,displayName:e}}));M(t,r)}))}))}},"clear tabs":{displayName:"Clean Redundant Tabs",f:function(){chrome.tabs.query({currentWindow:!0},(function(t){var e,n=[],r=Object(l.a)(t);try{var o=function(){var t=e.value;if(n.find((function(e){return e.url===t.url})))return chrome.tabs.remove(t.id),"continue";n.push(t)};for(r.s();!(e=r.n()).done;)o()}catch(a){r.e(a)}finally{r.f()}}))}}}},j=Object(w.a)();function S(){chrome.tabs.query({highlighted:!0,currentWindow:!0},(function(t){var e,n=[],r=[],o=Object(l.a)(t);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.id,c=a.title,u=a.url;n.push(i),r.push({title:c,url:u})}}catch(s){o.e(s)}finally{o.f()}chrome.tabs.remove(n,(function(){j.addStashEntries(r)}))}))}function I(t){var e=new URL(t);return"chrome:"===e.protocol?"chrome://"+e.hostname:e.hostname.startsWith("www.")?e.hostname.substr(4):e.hostname}chrome.runtime.onConnect.addListener((function(t){var e=t.name,n=t.onMessage;e==h.j&&n.addListener((function(t){switch(console.debug("Receiving message:",t),t.type){case h.b:v();break;case h.f:g(t.offset);break;case h.c:p();break;case h.g:n=t.offset,chrome.tabs.query({currentWindow:!0},(function(t){var e=t.filter((function(t){return t.pinned})).length+n;-1<e<t.length&&chrome.tabs.update(t[e].id,{active:!0})}));break;case h.h:S();break;case h.i:e=t.stashKey,chrome.storage.sync.get(Object(d.a)({},e,{}),(function(t){!function t(e,n){if(0==e.length)n();else{var r=s(e),o=r[0],a=r.slice(1);chrome.tabs.create({url:o},(function(){t(a,n)}))}}(t[e].map((function(t){return t.url})),(function(){chrome.storage.sync.remove(e)}))}));break;case h.a:!function(t){chrome.tabs.query({currentWindow:!0},(function(e){var n=e.length,r=e.find((function(t){return t.active})),o=e[(n+r.index+t)%n];o.highlighted?chrome.tabs.update(r.id,{highlighted:!1}):chrome.tabs.update(o.id,{highlighted:!0})}))}(t.offset);break;case h.e:!function(){t=function(t){null!==t&&T(t,(function(){E(t.tabId)}))},k((function(e){!function t(e,n){null!==e.forward?U(e.forward.tabId,(function(r){r?n(e.forward):t(e.forward,n)})):n(null)}(e,t)}));var t}();break;case h.d:!function(){t=function(t){null!==t&&T(t,(function(){E(t.tabId)}))},k((function(e){!function t(e,n){null!==e.back&&null!==e.back.tabId?U(e.back.tabId,(function(r){r?n(e.back):t(e.back,n)})):n(null)}(e,t)}));var t}()}var e,n}))})),chrome.runtime.onMessageExternal.addListener((function(t,e,n){switch(console.debug("request: ",t),t.type){case"action spec":n({name:O.name,actions:Object.entries(O.actions).map((function(t){var e=Object(f.a)(t,2);return{name:e[0],displayName:e[1].displayName}}))});break;case"execute action":var r=O.actions[t.action.name],o={sender:e};void 0!==r&&r.f(o);break;case"select/response":if(t.cancelled||void 0===t.selected)return;console.log("request.selected:",t.selected),E(parseInt(t.selected))}}));var A=void 0,N=void 0,q={back:null,forward:null,tabId:null};function W(t){chrome.storage.sync.get({tabActivity:{}},(function(e){var n=e.tabActivity;A||(A=n),t(A)}))}function k(t){chrome.storage.sync.get({tabNavigator:q},(function(e){var n=e.tabNavigator;N||(N=n),t(N)}))}function T(t,e){N=t,chrome.storage.sync.set({tabNavigator:t},e)}function x(t,e){var n=Date.now();console.debug("recordTabActivity: tabId:",t,"timestamp:",n),W((function(r){r[t]=n,e(r),chrome.storage.sync.set({tabActivity:r}),k((function(e){if(e.tabId!==t){var n={tabId:t,forward:null,back:e};e.forward=n,T(n,(function(){console.debug("recordTabActivity: Navigator Updated:",n)}))}}))}))}function M(t,e){chrome.runtime.sendMessage(t.sender.id,{type:"select",hint:"Where do you want to go?",options:e})}function E(t){chrome.tabs.get(t,(function(e){chrome.tabs.update(t,{active:!0},(function(){chrome.windows.update(e.windowId,{focused:!0})}))}))}function U(t,e){chrome.tabs.get(t,(function(){var n=chrome.runtime.lastError;console.debug(n),e(!n||n.message!=="No tab with id: ".concat(t,"."))}))}chrome.runtime.onInstalled.addListener((function(){chrome.storage.sync.get({tabActivity:{}},(function(t){var e=t.tabActivity;chrome.tabs.query({},(function(t){var n,r={},o=Object(l.a)(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;r[a.id]=e[a.id]}}catch(i){o.e(i)}finally{o.f()}chrome.storage.sync.set({tabActivity:r})}))}))})),chrome.windows.onFocusChanged.addListener((function(t){chrome.tabs.query({windowId:t,active:!0},(function(t){x(Object(f.a)(t,1)[0].id,(function(t){console.debug("windows.onFocusChanged: Recording tab activity",t)}))}))})),chrome.tabs.onActivated.addListener((function(t){x(t.tabId,(function(t){console.debug("tabs.onActivated: Recording tab activity",t)}))})),chrome.tabs.onRemoved.addListener((function(t){console.debug("Clearing up tab entry"),console.debug(t),W((function(e){delete e[t],chrome.storage.sync.set({tabActivity:e}),console.debug(e)}))}))},4:function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return r}))},5:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,"a",(function(){return r}))},6:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(3);function o(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=Object(r.a)(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a,i=!0,c=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==o.return||o.return()}finally{if(c)throw a}}}}},7:function(t,e,n){"use strict";function r(t){if(Array.isArray(t))return t}n.d(e,"a",(function(){return r}))},8:function(t,e,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(e,"a",(function(){return r}))}});
//# sourceMappingURL=background.js.map